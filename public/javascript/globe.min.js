function ready(t,a){var e=svg.append("defs").append("radialGradient").attr("id","ocean_fill").attr("cx","75%").attr("cy","25%");e.append("stop").attr("offset","5%").attr("stop-color","#333333"),e.append("stop").attr("offset","100%").attr("stop-color","#000000");var r=svg.append("defs").append("radialGradient").attr("id","globe_highlight").attr("cx","75%").attr("cy","25%");r.append("stop").attr("offset","5%").attr("stop-color","#ffd").attr("stop-opacity","0.2"),r.append("stop").attr("offset","100%").attr("stop-color","#ba9").attr("stop-opacity","0.1");var o=svg.append("defs").append("radialGradient").attr("id","globe_shading").attr("cx","55%").attr("cy","45%");o.append("stop").attr("offset","30%").attr("stop-color","#fff").attr("stop-opacity","0"),o.append("stop").attr("offset","100%").attr("stop-color","#505962").attr("stop-opacity","0.1");var s=svg.append("defs").append("radialGradient").attr("id","drop_shadow").attr("cx","50%").attr("cy","50%");s.append("stop").attr("offset","20%").attr("stop-color","#000").attr("stop-opacity",".5"),s.append("stop").attr("offset","100%").attr("stop-color","#000").attr("stop-opacity","0"),svg.append("circle").attr("cx",width/2).attr("cy",height/2).attr("r",outerSpace.scale()).attr("id","galaxy"),svg.append("g").attr("class","stars").selectAll("g").data(arrayC).enter().append("path").attr("class","star").attr("d",starsPath).style("fill","rgb(255,255,255)"),svg.append("ellipse").attr("cx",440).attr("cy",450).attr("rx",.9*proj.scale()).attr("ry",.25*proj.scale()).attr("class","noclicks").style("fill","url(#drop_shadow)"),svg.append("circle").attr("cx",width/2).attr("cy",height/2).attr("r",proj.scale()).attr("class","noclicks").style("fill","url(#ocean_fill)"),svg.append("path").datum(topojson.feature(a,a.objects.land)).attr("class","land noclicks").attr("d",path),svg.append("circle").attr("cx",width/2).attr("cy",height/2).attr("r",proj.scale()).attr("class","noclicks").style("fill","url(#globe_highlight)"),svg.append("circle").attr("cx",width/2).attr("cy",height/2).attr("r",proj.scale()).attr("class","noclicks").style("fill","url(#globe_shading)"),refresh(),d3.timer(function(){if(rotating){var t=velocity*(Date.now()-t0);proj.rotate([t,0,0]),outerSpace.rotate([-t,0,0]),svg.selectAll(".star").attr("d",starsPath.projection(outerSpace)),svg.selectAll(".land").attr("d",path.projection(proj)),svg.selectAll(".points").attr("d",path.projection(proj))}})}function refresh(){svg.selectAll(".star").attr("d",starsPath),svg.selectAll(".land").attr("d",path),svg.selectAll(".points").attr("d",path)}function mousedown(){0!=rotating?rotating=!1:mouse_rotation=!1,m0=[d3.event.pageX,0,0],g0=outerSpace.rotate(),o0=proj.rotate(),d3.event.preventDefault()}function mousemove(){if(m0){var t=[d3.event.pageX,0,0],a=[o0[0]+(t[0]-m0[0])/12,0,0],e=[g0[0]+(t[0]-m0[0])/12,0,0];proj.rotate(a),outerSpace.rotate(e),refresh()}}function mouseup(){m0&&(mousemove(),m0=null,0!=mouse_rotation&&(rotating=!0),mouse_rotation=null)}function tweet(t){svg.append("path").datum(t.geo).attr("class","points").attr("id","tweet_"+tweetId).attr("data-function","popover").attr("data-trigger","click").attr("title",t.profile).attr("data-content","<div class=popover_tweet><img src='"+t.image+"' class='img-circle'><div class='tweet_text'>"+t.tweet+"</div></div>").attr("d",path.pointRadius(5)).style("stroke","#0000FF").style("fill","#00a5ff"),setTimeout(function(){d3.selectAll("#tweet_"+removeTweetId).remove(),removeTweetId++},1e4),tweetId++}d3.select("#tweet_globe").on("mousemove",mousemove).on("mouseup",mouseup);var size,width=$("#tweet_globe").width(),height=$("#tweet_globe").height(),arrayC=[],origin=[71,-42],velocity=.005,t0=Date.now(),rotating=!0,tweetId=0,removeTweetId=0;size=481>width?5e3:768>width?1e3:1200>width?1500:2e3;for(var i=0;size>i;i++)arrayC.push({geometry:{type:"Point",coordinates:[360*Math.random()-180,180*Math.random()-90]},type:"Feature",properties:{radius:1.5*Math.random()}});var outerSpace=d3.geo.azimuthalEquidistant().translate([width/2,height/2]),space=outerSpace.scale(3*outerSpace.scale()),starsPath=d3.geo.path().projection(space).pointRadius(1),proj=d3.geo.orthographic().translate([width/2,height/2]).clipAngle(90),globe=proj.scale(200),path=d3.geo.path().projection(globe),graticule=d3.geo.graticule(),svg=d3.select("#tweet_globe").append("svg").attr("width",width).attr("height",height).attr("xmlns","http://www.w3.org/2000/svg").attr("id","starry").attr("x-axis",0).attr("y-axis",0).on("mousedown",mousedown);queue().defer(d3.json,"world-110m.json").await(ready);var m0,o0,g0,mouse_rotation;